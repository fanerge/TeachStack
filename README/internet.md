# 概念

ISP：互联网服务提供商（Internet Service Provider）。<br>
路由器：路由器是连接两个或多个网络的硬件设备，在网络间起网关的作用，是读取每一个数据包中的地址然后决定如何传送的专用智能性的网络设备。<br>
交换机：交换机（Switch）意为“开关”是一种用于电（光）信号转发的网络设备。它可以为接入交换机的任意两个网络节点提供独享的电信号通路。<br>
集线器：古老的设备了，作用在物理层设备，它在网络中只起到信号放大和重发作用。<br>
网桥：网桥（Bridge）是早期的两端口二层网络设备，用来连接不同网段。网桥的两个端口分别有一条独立的交换信道，不是共享一条背板总线，可隔离冲突域。网桥比集线器（Hub）性能更好，集线器上各端口都是共享同一条背板总线的。网桥处于数据链路层。<br>
IP 协议：选择最佳路径。<br>
IPv6：IPv6 的地址长度为 128 位，是 IPv4 地址长度的 4 倍。<br>
RTT（Round-Trip Time）往返时间，发送数据到接收数据的时间。<br>
网卡：是一块被设计用来允许计算机在计算机网络上进行通讯的计算机硬件，是工作在 OSI 的物理层和数据链路层。<br>
MAC 地址：IP 地址与 MAC 地址在计算机里都是以二进制表示的，IP 地址是 32 位的，而 MAC 地址则是 48 位的，作用能够标识具体的网络节点。<br>
ARP：地址解析协议，即 ARP（Address Resolution Protocol），是根据 IP 地址获取物理地址的一个 TCP/IP 协议，方式为广播，只能局域网，也就是不能跨路由。<br>
RARP：反向地址转换协议（RARP：Reverse Address Resolution Protocol） 反向地址转换协议（RARP）允许局域网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP 地址。<br>
ARP 欺骗：是以太网地址解析协议（ARP）的一种攻击技术，通过欺骗局域网内访问者 PC 的网关 MAC 地址，使访问者 PC 错以为攻击者更改后的 MAC 地址是网关的 MAC，导致网络不通，避免方法：可以通过 arp -s ipaddress macaddress 来绕开 ARP 协议。<br>
ICMP：ICMP（Internet Control Message Protocol）Internet 控制报文协议。它是 TCP/IP 协议簇的一个子协议，作用用于在 IP 主机、路由器之间传传输出错报告控制信息。<br>
IGMP：IGMP（Internet Group Management Protocol），是因特网协议家族中的一个组播协议。该协议运行在主机和组播路由器之间。<br>
TTL 是 Time To Live 的缩写，该字段指定 IP 包被路由器丢弃之前允许通过的最大网段数量，防止数据包在网络死循环。<br>
PPP 协议：点对点协议（Point to Point Protocol，PPP）为在点对点连接上传输多协议数据包提供了一个标准方法。<br>
CSMA/CD 即载波侦听多路访问/冲突检测，是广播型信道中采用一种随机访问技术的竞争型访问方法，具有多目标地址的特点。<br>
子网掩码：(subnet mask)又叫网络掩码、地址掩码、子网络遮罩，它是一种用来指明一个 IP 地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合 IP 地址一起使用。子网掩码只有一个作用，就是将某个 IP 地址划分成网络地址和主机地址两部分。<br>
病毒运行在应用层，病毒的本质是代码，但会影响其它层（比如发送大量广播暂用带宽，导致局域网阻塞或访问外网阻塞）。<br>
泪滴攻击：(TearDrop)指的是向目标机器发送损坏的 IP 包，诸如重叠的包或过大的包载荷。借由这些手段，该攻击可以通过 TCP/IP 协议栈中分片重组代码中的 bug 来瘫痪各种不同的操作系统。<br>
网关：网关(Gateway)就是一个网络连接到另一个网络的“关口”，网关实质上是一个网络通向其他网络的 IP 地址。<br>
端口：端口用 16 位端口号进行标志（共 65536 个），标志着本计算机应用层中的各个进程。<br>

# 网络设备和 ISO 模型关系

## 发送端（接收端反过来即可）

1.  应用程序准备要传输的文件
2.  传输层，将文件分段，并编号
3.  网络层，添加目标 IP 地址要源 IP 地址
4.  数据链路层，添加目标 MAC 地址要源 MAC 地址，两种情况 1.使用自己的子网掩码，判断自己在哪个网段 2.使用自己的子网掩码，判断目标地址在哪个网段
    如果是同一个网段，就 ARP 协议广播解析目标 IP 地址的 MAC
5.  物理层，比特流（二进制）

# OSI7 层模型

```
应用层：所有能产生网络流量的程序
表示层：在传输之前（或接收之后）是否进行加密或压缩处理二进制 ASCII
会话层：查木马 netstat -n
传输层：可靠传输 流浪控制 不可靠传输（单个数据包就能搞定）
网络层：负责选择最佳路径 规划 IP 地址
数据链路层：帧的开始和结束 透明传输 差错校验
物理层：接口标准 电器标准 如何在物理链路上传输更快的速度
```

#   充分利用缓存
##  强缓存
1.	Expires
用来设置缓存时间，它对应一个未来的时间戳。
问题：客户端时间可以更改导致缓存失效，不够精确只能到秒。
2.	Cache-Control
cache-control 的 max-age 优先级高于 Expires，表示资源有效的最大时间（秒）。
no-cache，表示使用协商缓存，即每次使用缓存前必须向服务端确认缓存资源是否更新；
no-store，禁止浏览器以及所有中间缓存存储响应内容；

##  协商缓存
服务端要判断缓存有没有过期，只能将双方的资源进行对比。
1.	Last-Modified 和 If-Modified-Since
每个文件都有一个最后修改的时间，如果最后最后修改时间相同，则说明该资源够新鲜。
问题：精度问题，修改一个文件后又撤销修改会导致缓存失效
2.	ETag 和 If-None-Match
Etag 字段值为该资源的哈希值。
nginx 生成 Etag 是通过，Last-Modified 和 Content-length 来生成的。
问题：计算成本（计算资源哈希值消耗内存），计算误差（不同系统生成Etag值方式不一样，导致集群中缓存命中率不高）

# 服务和应用层协议之间关系

1.  服务使用 TCP 或 UDP 的端口侦听客户端请求（TCP 的 443 为 HTTPS 服务）
2.  客户端使用 IP 地址定位服务器，使用目标端口定位服务
3.  可以在服务器网卡上设置只开放必要的端口来实现服务器网络安全

# TCP/IP 协议栈

## 应用层

```
传输的内容：上层数据
排错：应用层程序配置错误
安全隐患：开发的应用程序漏洞
域名系统 DNS
动态主机配置协议 DHCP
文件传输协议 FTP
远程终端协议 TELNET
远程桌面 RDP
万维网协议 WWW
电子邮件 SMTP POP3 IMAP
```

### 域名解析过程（分布式查询技术）

```
根DNS服务器共13台 （负责顶级域名找对应服务器查询）
com、netDNS服务器 （负责各个顶级域名的查询）
获得对应ip就缓存，下次直接使用
```

### 域名

```
根 （.）
顶级域名 （com\edu\net等）
二级域名 （github.com）
三级域名 （ifs.github.com）
```

### DHCP 动态主机配置

```
静态 IP 地址
动态 IP 地址（避免地址冲突）
跨网段地址分配 (只需要创建多个网段)
DHCP 客户端请求 IP 地址的过程：客户端（设置为自动获取 ip 地址）发一个广播（ip 地址为 255.255.255.255，mac 地址为 ffffff），该类型的广播交换机会传到所有接口（这样所有都能收到请求），DHCP 服务器会从 ip 池中找一个 ip 发给客户端，客户端确认后就可以使用该 ip 地址（当然 DHCP 服务器必须是静态地址）。
```

### FTP 文件传输协议

```
FTP 使用的两个 TCP 连接，一个 TCP 控制连接（控制进程，端口为 21），TCP 数据连接（数据传送进程，端口为 20）
主动模式：ftp 客户端告诉服务器使用什么端口侦听，ftp 服务器和 ftp 客户端的这个端口建立连接，源端口 20
被动模式：ftp 服务器打开新端口，等待 ftp 客户端的连接，如果有防火墙，需要在防火墙开 21 和 20 端口，使用主动模式进行数据连接
```

### TELNWET 远程终端协议

默认使用 TCP 的 23 端口

## 传输层

当需要对传输的文件分段传输、建立会话、可靠传输、流量控制，需要 TCP 协议。<br>
一个数据包就能够完成数据通信、不分段、不建立会话、不使用流量控制、不可靠传输，需要使用 UDP 协议。<br>
屏幕广播 🖥 使用的是 UDP，DNS 即可能使用 UDP 又可能使用 TCP。<br>
协议：TCP、UDP<br>
传输的内容：TCP 头 + 上层数据 === 数据段/消息<br>
可靠传输由传输层决定<br>
作用：将数据分段或将数据按序列拼接(会检测是否丢包重传，所以是数据的可靠性由传输层决定)。<br>
传输层的功能：为相互通信的应用进程/程序提供了逻辑通信。<br>

### UDP

UDP 无连接的，不可靠，不使用拥塞控制，面向报文（适合多媒体通信），支持一对一、一对多、多对一的交互通信，首部开销小，8 字节。<br>
UDP 的首部：8 字节。2（源端口）+2（目标端口）+2（长度，UDP 放入首部和数据的长度）+2（检验和）<br>

### TCP

TCP 是面向连接的（可靠，三次握手 🤝 建立连接），面向字节流的，流量控制，网络拥塞。<br>
TCP 连接的端点叫做套接字（socket），套接字其实就是 IP 地址+端口。<br>
RTT(Round-Trip Time):往返时延。是指数据从网络一端传到另一端所需的时间。<br>

#### TCP三次握手的目的    
tcp三次握手，能够确认客户端和服务端都有发送数据和接收数据的能力。
[TCP协议灵魂之问，巩固你的网路底层基础](https://juejin.im/post/5e527c58e51d4526c654bf41)
#### 可靠传输

可靠传输原理：确认和重传机制。<br>
停止等待协议（等待接收方确认，发送下一个包，但会出现信道利用率低的问题）。<br>
以字节为单位的滑动窗口技术，解决停止等待协议信道利用率低问题流水线传输维持发送窗口数。<br>
累计确认（记录最后确认收到的包，然后重发该包，接收方接收到后，确认数向后移动一个）。<br>
超时重传（超时时间略大于 RTT）。<br>

#### 流量控制

通过接收端告诉发送端，接收窗口有多大来实现（调整滑动窗口大小）。<br>

#### 避免网络拥塞

本质：它所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收。<br>
慢开始，发送方维持拥塞窗口 cwnd(congestion window)大小。<br>
工作原理：先慢开始（指数增长），直到到达慢开始门限转为拥塞避免算法（加法增长），当网络拥塞立即（乘法减小），然后又慢启动重复以上过程。（已废弃）<br>
快重传和快恢复：先慢开始（指数增长），直到到达慢开始门限转为拥塞避免算法（加法增长），当发送方连续收到三个重复的确认转入拥塞避免，使用快恢复将 cwnd 设置为慢开始门限的一半，然后重复拥塞避免算法（加法增加）。<br>
TCP 建立连接（三次握手 🤝）：建立连接。<br>
TCP 断开连接（四次握手）：客户端接收到服务端连接断开确认后 TCP 连接必须经过时间 2MSL 后才真正释放掉。<br>
MSL 是 Maximum Segment Lifetime 英文的缩写，中文可以译为“报文最大生存时间”，他是任何报文在网络上存在的最长时间，超过这个时间报文将被丢弃。<br>

## 网络层

传输的内容：IP 头 + TCP 头 + 上层数据 === 数据包<br>
排错：配置错误 IP 地址 子网掩码配置错我的网关 路由器没有配置到达目标网络的路由<br>
安全隐患：在路由器上使用 ACL 控制数据包流量<br>
作用：负责在不同网络之间尽力转发数据包（选择路径），基于数据包的 IP 地址转发，不负责丢失重传，也不负责顺序。<br>
网络层协议：ARP、IP、ICMP、IGMP。<br>
ping 命令是基于网络层的 ICMP 协议。<br>
路由器属于三层设备，包括网络层、数据链路层、物理层。<br>
信息传播方式：点到点、广播（一个网段所有计算机都可以接收）、组播（一个网段部分计算机都可以接收）<br>
IP 协议：路由分为静态路由和动态路由，静态路由有管理员手动设置，优先级较高，单仅适合小规模网络，不能够自动调整路由。<br>
动态路由：RIP(Routing Information Protocol,路由信息协议）周期性广播路由表，跳数少为基准（最大跳数为 15 跳，超过则认为不可达，也就说明适用于小型网络），30s 更新一次。<br>
OSPF(Open Shortest Path First,开放式最短路径优先）周期性广播路由表，带宽为基准（适用于大型网络）。<br>

## 数据链路层

传输的内容：MAC 头 IP 头 + TCP 头 + 上层数据 + FCS === 数据帧<br>
排错：MAC 地址冲突，ADSL 欠费（MAC 认证，类似白名单）网速没办法协商一致<br>
安全隐患：ADSL 账号密码 VLAN 交换机端口绑定 MAC 地址<br>
数据链路层的信道类型：点对点信道（PPP 协议）、广播信道（CSMA/CD）。<br>
解决问题：

1.  封装成帧（有帧头和帧尾作为每帧的标记）
2.  透明传输（传时添加转义字符接收时去掉转义字符）
3.  差错控制（电磁干扰等，保证信息的准确）

```
循环冗余检验 CRC 计算出的帧检验序列（FCS）
帧间最小间隔为 9.6us，用于刚刚收到数据帧的站的接收缓存来的及清理，做好接收下一帧的准备。
MAC 地址、网桥属于数据链路层
交换机属于二层设备，包括数据链路层、物理层。
MTU( Maximum Transmission Unit)：最大传输单元。链路层有个特性，数据帧的长度比链路层的 MTU（1500 字节）还大，那么 IP 层就需要进行分片( fragmentation)，即把数据报分成干片，这样每一片就都小于 MTU。
```

## 物理层

传输的内容：01 码 === Bit<br>
作用：如何在连接各种计算机的传输媒体（双绞线、光纤、无线）上传输数据比特流，规范各厂商生产出具有相同的机械、电气、功能等特性（如接口大小及形状、电压范围）的产品。<br>
传输媒体：双绞线、同轴电缆、微波、集线器<br>
排错：查看链接状态，发送和接收的数据包（接收和发送一个为 0 则为物理层出错）<br>
安全隐患：别人能接到你的网线<br>

# 常见问题

## 为什么说 UDP 是面向报文的,而 TCP 是面向字节流的

UDP 是面向报文的，发送方的 UDP 对应用层交下来的报文，不合并，不拆分，只是在其上面加上首部后就交给了下面的网络层，也就是说无论应用层交给 UDP 多长的报文，它统统发送，一次发送一个。而对接收方，接到后直接去除首部，交给上面的应用层就完成任务了。因此，它需要应用层控制报文的大小。<br>
TCP 是面向字节流的，它把上面应用层交下来的数据看成无结构的字节流来发送，可以想象成流水形式的，发送方 TCP 会将数据放入“蓄水池”（缓存区），等到可以发送的时候就发送，不能发送就等着，TCP 会根据当前网络的拥塞状态来确定每个报文段的大小。<br>

# 常见的协议对应协议号

```
ICMP 1
IGMP 2
IP 4
TCP 6
UDP 17
```

# 常见的应用端口号

```
// 常见的应用层协议使用的端口
http=TCP+80
https=TCP+443
RDP=TCP+3389
ftp=TCP+21
共享文件夹=TCP+445
SMTP=TCP+25 // 发邮件
POP3=TCP+110 // 收邮件
telnet=TCP+23
DNS=UDP+53 / TCP+53
```

# 常见网络命令

```
ping [ip|domain] // 通过ICMP协议检测和对应计算机是否连通（4个包后结束）
ping [ip|domain] -t // （一直保持ping）
ping [ip|domain] -i 2 // 更改数据包跟踪的TTL，跟踪途径2个路由器
traceroute [ip|domain] // (Windows 系统下是tracert) 命令利用ICMP 协议定位您的计算机和目标计算机之间的所有路由器。
netstat // 用于显示网络状态
netstat -nb // 用于查看会话是哪个进程产生的
nslookup // 查询域名信息
arp -a // 参看当前计算机记录的ARP协议的mac地址
arp -s ip mac // 为计算机添加一条ARP协议的mac地址
ipconfig | ifconfig // ip相关信息
```

[](https://blog.csdn.net/iwanderu/article/details/103812974)
